<% content_for :title, "Articles" %>

<div id="articles">
  <div class="container">

  <div class="row justify-content-center">
  <div class="col-12 col-sm-6 mb-4">

    <% if notice %>
      <p class="my-3">
        <span class="d-block notice" style="color: red"> <%= notice %> </span>
      </p>
    <% end %>

    <nav aria-label="Page navigation">
      <ul class="pagination pagination-lg justify-content-center">
        <%== pagy_bootstrap_nav(@pagy) %>
      </ul>
    </nav>

      <% @articles.each do |article| %>

      <%= render article %>

      <% if (comment = article.comments.last) %>  <!-- Asigno el último comentario y verifico si existe -->
          
        <h6 class="mt-2">Último comentario, realizado el <%= comment.created_at.strftime("%d-%m-%Y") %> </h6>

        <div class="d-flex align-items-start my-2 border rounded-2">
            <% if user_signed_in? %>
              <div class="ms-2"> 
                <% if current_user.photo.attached? %>
                    <%= image_tag current_user.photo, class: "img-fluid rounded-circle", style: "max-width: 50px; max-height: 50px; width: 100%; height: auto;" %>
                <% end %>
              </div>
            <% end %>
            <div class="flex-grow-1 ms-2"> 
              <strong>Usuario   </strong> : <%= comment.user.name if comment.user %> 
              <br>
              <strong>Comentario</strong> : <%= comment.content %>
            </div>
        </div>
     
      <% end %>

      <%= form_with(model: [ article, Comment.new ]) do |form| %>

          <div class="my-2 w-100">
              <div class="form-group my-2">
                <%= form.label :content, "Comenta este artículo", class: "col-12" %>
                <br>
                <%= form.text_area :content, required: true, class: "ps-2 w-100 border rounded-2", rows: 3 %>
              </div>
          </div>

          <%= form.submit "Comentar", class: "btn btn-primary mb-5" %>

        <% end %>

    <% end %>
    <br>
  </div>
  </div>
  </div>

</div>

